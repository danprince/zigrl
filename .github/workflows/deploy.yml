name: Deploy
on: [push,pull_request]
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout
        uses: actions/checkout@v2
      - name: âš¡ï¸ Setup Zig
        uses: goto-bus-stop/setup-zig@v2
      - name: ğŸ” Lint
        run: zig fmt --check src
      - name: ğŸ§ª Test
        run: zig build test
      - name: ğŸ”¨ Build
        run: zig build -Drelease-small=true
      - name: ğŸ—‘ï¸ Clean
        run: rm web/dist/*.{so,o}*
      - name: ğŸ“¦ Zip
        run: cd web && zip ../game.zip -r *
      - name: â˜ï¸ Deploy
        run: "curl -H 'Content-Type: application/zip' -H 'Authorization: Bearer ${{ secrets.NETLIFY_ACCESS_TOKEN }}' --data-binary '@game.zip' https://api.netlify.com/api/v1/sites/${{ secrets.NETLIFY_SITE_ID }}/deploys"
